<script type="text/javascript">
  var serverActivityCountdown = 0
  var serverActivityCountdownInterval = 30 // in seconds

  function serverActivityUpdateMeetingsLoad() {
    $("bbbrails_server_activity_meetings").load("<%= activity_online_meeting_server_path(:id=>@server.id, :update_list => true) %>", serverActivityUpdateMeetingsEnd());
  }

  function serverActivityUpdateMeetingsStart() {
    clearInterval(serverActivityCountdown);
    $("bbbrails_countdown_value").innerHTML = "Now...";
    serverActivityUpdateMeetingsLoad();
  }

  function serverActivityUpdateMeetingsEnd() {
    $("bbbrails_countdown_value").innerHTML = "Done!";
    serverActivitySetCountdown();
  }

  function serverActivitySetCountdown() {
    var count = serverActivityCountdownInterval;
    serverActivityCountdown = setInterval(function(){
      $("bbbrails_countdown_value").innerHTML =  count + " seconds";
      if (count == 0) {
        serverActivityUpdateMeetingsStart();
      }
      count--;
    }, 1000);
  }

 document.observe("dom:loaded", function() {
    serverActivitySetCountdown();

    $$('bbbrails_countdown a.bbbrails_refresh_now').click(function() {
      serverActivityUpdateMeetingsStart();
      return false;
    });
  });

</script>

<div id="bbbrails_countdown">
  <%= t('refreshing_in') %>: <span id="bbbrails_countdown_value"></span>
  (<a class="bbbrails_refresh_now" href="<%= activity_online_meeting_server_path(:id=>@server) %>"><%= t('refresh_now') %></a>)
</div>

<h1><%= t('server_activity_monitor') %>:</h1>

<div id="bbbrails_server_activity_meetings">
  <%= render :partial => 'activity_list' %>
</div>
